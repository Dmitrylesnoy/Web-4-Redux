<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:p="primefaces"
  lang="en">
  <h:head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Линейский Аким Евгеньевич" />
    <meta name="group" content="P3215" />
    <meta name="variant" content="26499" />
    <title>Web-prog Lab-3</title>

    <h:outputStylesheet library="css" name="styles.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <h:outputScript library="js" name="graph.js" />
    <h:outputScript> window.pointsData = '#{hitData.dataAsJson}'; </h:outputScript>
    <h:outputScript library="js" name="main.js" />
  </h:head>

  <body>
    <div class="notifications"></div>
    <header>
      <h1>Web - lab 3. var - 26499</h1>
      <h2>Линейский Аким Евгеньевич, группа P3215</h2>
    </header>

    <main class="main-container">
      <div class="main-row">
        <div class="card">
          <h:form id="formCoords">
            <div class="input-group">
              <label for="x" class="required-field">X:</label>
              <h:selectOneRadio id="x" value="#{point.x}" required="true" validator="#{validator.validatePointX}">
                <f:selectItem itemValue="-4" itemLabel="-4" />
                <f:selectItem itemValue="-3" itemLabel="-3" />
                <f:selectItem itemValue="-2" itemLabel="-2" />
                <f:selectItem itemValue="-1" itemLabel="-1" />
                <f:selectItem itemValue="0" itemLabel="0" />
                <f:selectItem itemValue="1" itemLabel="1" />
                <f:selectItem itemValue="2" itemLabel="2" />
                <f:selectItem itemValue="3" itemLabel="3" />
                <f:selectItem itemValue="4" itemLabel="4" />
              </h:selectOneRadio>
              <h:message for="x" styleClass="error-message" />
            </div>
            <div class="input-group">
              <label for="y" class="required-field">Y:</label>
              <h:inputText
                id="y"
                value="#{point.y}"
                required="true"
                validator="#{validator.validatePointY}"
                maxlength="8"
                placeholder="От -5 до 3" />
              <br />
              <h:message for="y" styleClass="error-message" />
            </div>
            <div id="r-group" class="input-group">
              <label for="r" class="required-field">R:</label>
              <h:inputHidden id="r" value="#{Rbean.value}" validator="#{validator.validateR}" />
              <h:commandButton id="rButton" styleClass="ui-button" value="#{Rbean.value}">
                <f:ajax execute="@this" listener="#{Rbean.updateValue}" render="r-group r rButton" />
              </h:commandButton>
              <br />
              <h:message for="r" styleClass="error-message" />
            </div>
            <div>
              <h:commandButton id="submitBtn" styleClass="ui-button" value="Check" action="#{inputProcess.submitPoint}">
                <f:ajax execute="@form" render="@form tableData" oncomplete="loadPointsData(); updateGraph();" />
              </h:commandButton>
              <h:commandButton
                id="resetBtn"
                styleClass="ui-button"
                value="Reset"
                action="#{Rbean.reset}"
                immediate="true">
                <f:ajax execute="@this" render="@form" />
              </h:commandButton>
            </div>
            <h:outputScript> window.pointsData = '#{hitData.dataAsJson}'; updateGraph(); </h:outputScript>
          </h:form>
          <h:form>
            <h:commandButton id="moveToHelloButton" styleClass="ui-button" value="Go to Hello page" action="hello" />
          </h:form>
        </div>
        <div class="card">
          <canvas id="graph" class="card" width="500" height="500"></canvas>
        </div>
      </div>
      <div class="main-row">
        <div class="card">
          <h:graphicImage library="media" name="frog.jpeg" width="400px" alt="Frog" />
        </div>
        <div class="table card">
          <h:dataTable
            id="tableData"
            value="#{hitData.data}"
            var="pointData"
            styleClass="data-table"
            rowClass="#{pointData.hit ? 'hit-yes' : 'hit-no'}">
            <h:column>
              <f:facet name="header">X</f:facet>
              #{pointData.x}
            </h:column>
            <h:column>
              <f:facet name="header">Y</f:facet>
              #{pointData.y}
            </h:column>
            <h:column>
              <f:facet name="header">R</f:facet>
              #{pointData.r}
            </h:column>
            <h:column>
              <f:facet name="header">Hit</f:facet>
              #{pointData.hit ? 'Yes' : 'No'}
            </h:column>
            <h:column>
              <f:facet name="header">Calc time</f:facet>
              #{pointData.execTime} ns
            </h:column>
            <h:column>
              <f:facet name="header">Current time</f:facet>
              #{pointData.dataFormatted}
            </h:column>
          </h:dataTable>
        </div>
      </div>
    </main>
  </body>
</html>
